<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Administrasi DKI Jakarta Lengkap</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body, html { height: 100%; margin: 0; }
        #map { height: 100vh; width: 100%; z-index: 0; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* Scrollbar Halus */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Marker & Animation */
        .pulse-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            animation: pulse-animation 2s infinite;
        }
        @keyframes pulse-animation {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.3); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(0, 0, 0, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); }
        }

        /* Accordion Transition */
        .accordion-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
        }
        .accordion-content.active {
            max-height: 500px; /* arbitrary large height */
            opacity: 1;
        }
        
        /* Custom Tooltip Style (Label Kecamatan) */
        .kecamatan-label {
            background-color: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid #cbd5e1 !important;
            border-radius: 9999px !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            font-size: 10px !important;
            font-weight: 700 !important;
            color: #334155 !important;
            padding: 2px 8px !important;
            white-space: nowrap !important;
        }
        .kecamatan-label::before {
            display: none !important; /* Hide the little triangle pointer for cleaner look */
        }
    </style>
</head>
<body class="bg-gray-100 overflow-hidden text-gray-800 font-sans">

    <!-- Sidebar -->
    <div class="absolute top-4 left-4 z-[1000] w-80 flex flex-col max-h-[90vh] shadow-2xl rounded-xl overflow-hidden transition-transform duration-300" id="sidebar">
        <!-- Header -->
        <div class="bg-slate-800 text-white p-4">
            <h1 class="font-bold text-lg flex items-center">
                <i class="fa-solid fa-map text-amber-400 mr-2"></i> DKI Jakarta
            </h1>
            <p class="text-xs text-slate-300 mt-1">Data Kecamatan & Kelurahan per Wilayah</p>
        </div>

        <!-- Navigation / Content -->
        <div class="glass-panel flex-1 overflow-y-auto custom-scroll p-2">
            <div id="city-list" class="space-y-2">
                <!-- City items generated by JS -->
            </div>
        </div>

        <!-- Detail Panel (Bottom Fixed inside Sidebar) -->
        <div id="detail-panel" class="bg-white border-t border-gray-200 p-4 hidden">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <span class="text-[10px] font-bold uppercase tracking-wider text-blue-600" id="detail-parent">JAKARTA BARAT</span>
                    <h2 class="font-bold text-lg leading-none" id="detail-title">Cengkareng</h2>
                </div>
                <button onclick="closeDetail()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
            </div>
            <p class="text-xs text-gray-500 mb-2 font-semibold">Daftar Kelurahan:</p>
            <div class="flex flex-wrap gap-1" id="detail-tags">
                <!-- Tags here -->
            </div>
        </div>
    </div>

    <!-- Mobile Toggle -->
    <button onclick="toggleSidebar()" class="absolute bottom-6 left-4 z-[1000] bg-slate-800 text-white p-3 rounded-full shadow-lg md:hidden">
        <i class="fa-solid fa-bars"></i>
    </button>

    <!-- Map -->
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script>
        // --- 1. DATA STRUKTUR (LENGKAP 5 WILAYAH) ---
        // Format: Kota -> Kecamatan -> Kelurahan
        // Coordinate approximation for districts
        
        const jakartaData = [
            {
                id: 'jakpus',
                name: 'Jakarta Pusat',
                color: '#ef4444', // Red
                center: [-6.1805, 106.8284],
                // Approximate polygon for visual boundary
                boundary: [
                    [-6.145, 106.815], [-6.155, 106.870], [-6.200, 106.860], [-6.215, 106.805], [-6.170, 106.800]
                ],
                districts: [
                    { name: 'Gambir', lat: -6.1767, lng: 106.8306, kels: ['Gambir', 'Kebon Kelapa', 'Petojo Selatan', 'Duri Pulo', 'Cideng', 'Petojo Utara'] },
                    { name: 'Tanah Abang', lat: -6.1887, lng: 106.8152, kels: ['Bendungan Hilir', 'Karet Tengsin', 'Kebon Melati', 'Kebon Kacang', 'Kampung Bali', 'Petamburan', 'Gelora'] },
                    { name: 'Menteng', lat: -6.1950, lng: 106.8320, kels: ['Menteng', 'Pegangsaan', 'Cikini', 'Kebon Sirih', 'Gondangdia'] },
                    { name: 'Senen', lat: -6.1880, lng: 106.8450, kels: ['Senen', 'Kwitang', 'Kenari', 'Paseban', 'Kramat', 'Bungur'] },
                    { name: 'Cempaka Putih', lat: -6.1800, lng: 106.8680, kels: ['Cempaka Putih Timur', 'Cempaka Putih Barat', 'Rawasari'] },
                    { name: 'Johar Baru', lat: -6.1850, lng: 106.8550, kels: ['Galur', 'Tanah Tinggi', 'Kampung Rawa', 'Johar Baru'] },
                    { name: 'Kemayoran', lat: -6.1600, lng: 106.8550, kels: ['Gunung Sahari Selatan', 'Kemayoran', 'Kebon Kosong', 'Harapan Mulya', 'Cempaka Baru', 'Utan Panjang', 'Sumur Batu', 'Serdang'] },
                    { name: 'Sawah Besar', lat: -6.1500, lng: 106.8300, kels: ['Pasar Baru', 'Gunung Sahari Utara', 'Mangga Dua Selatan', 'Karang Anyar', 'Kartini'] }
                ]
            },
            {
                id: 'jakut',
                name: 'Jakarta Utara',
                color: '#3b82f6', // Blue
                center: [-6.1300, 106.8800],
                boundary: [
                    [-6.090, 106.750], [-6.090, 106.970], [-6.170, 106.940], [-6.160, 106.860], [-6.130, 106.780]
                ],
                districts: [
                    { name: 'Penjaringan', lat: -6.1200, lng: 106.7800, kels: ['Penjaringan', 'Pluit', 'Pejagalan', 'Kapuk Muara', 'Kamal Muara'] },
                    { name: 'Tanjung Priok', lat: -6.1300, lng: 106.8700, kels: ['Tanjung Priok', 'Kebon Bawang', 'Sungai Bambu', 'Papanggo', 'Warakas', 'Sunter Agung', 'Sunter Jaya'] },
                    { name: 'Koja', lat: -6.1250, lng: 106.9050, kels: ['Koja', 'Rawa Badak Utara', 'Rawa Badak Selatan', 'Tugu Utara', 'Tugu Selatan', 'Lagoa'] },
                    { name: 'Cilincing', lat: -6.1200, lng: 106.9400, kels: ['Kali Baru', 'Cilincing', 'Semper Barat', 'Semper Timur', 'Sukapura', 'Rorotan', 'Marunda'] },
                    { name: 'Pademangan', lat: -6.1350, lng: 106.8400, kels: ['Pademangan Timur', 'Pademangan Barat', 'Ancol'] },
                    { name: 'Kelapa Gading', lat: -6.1600, lng: 106.9000, kels: ['Kelapa Gading Barat', 'Kelapa Gading Timur', 'Pegangsaan Dua'] }
                ]
            },
            {
                id: 'jakbar',
                name: 'Jakarta Barat',
                color: '#f59e0b', // Orange
                center: [-6.1600, 106.7500],
                boundary: [
                    [-6.100, 106.690], [-6.130, 106.820], [-6.200, 106.820], [-6.230, 106.770], [-6.180, 106.690]
                ],
                districts: [
                    { name: 'Cengkareng', lat: -6.1528, lng: 106.7431, kels: ['Cengkareng Barat', 'Cengkareng Timur', 'Duri Kosambi', 'Kapuk', 'Kedaung Kali Angke', 'Rawa Buaya'] },
                    { name: 'Grogol Petamburan', lat: -6.1687, lng: 106.7895, kels: ['Grogol', 'Jelambar Baru', 'Jelambar', 'Tanjung Duren Selatan', 'Tanjung Duren Utara', 'Tomang', 'Wijaya Kusuma'] },
                    { name: 'Taman Sari', lat: -6.1438, lng: 106.8188, kels: ['Glodok', 'Keagungan', 'Krukut', 'Mangga Besar', 'Maphar', 'Pinangsia', 'Taman Sari', 'Tangki'] },
                    { name: 'Tambora', lat: -6.1465, lng: 106.8045, kels: ['Angke', 'Duri Selatan', 'Duri Utara', 'Jembatan Besi', 'Jembatan Lima', 'Kali Anyar', 'Krendang', 'Pekojan', 'Roa Malaka', 'Tambora', 'Tanah Sereal'] },
                    { name: 'Kebon Jeruk', lat: -6.1912, lng: 106.7733, kels: ['Duri Kepa', 'Kebon Jeruk', 'Kedoya Selatan', 'Kedoya Utara', 'Kelapa Dua', 'Sukabumi Selatan', 'Sukabumi Utara'] },
                    { name: 'Kalideres', lat: -6.1464, lng: 106.7032, kels: ['Kalideres', 'Kamal', 'Pegadungan', 'Semanan', 'Tegal Alur'] },
                    { name: 'Palmerah', lat: -6.1923, lng: 106.7972, kels: ['Jatipulo', 'Kemanggisan', 'Kota Bambu Selatan', 'Kota Bambu Utara', 'Palmerah', 'Slipi'] },
                    { name: 'Kembangan', lat: -6.1918, lng: 106.7410, kels: ['Joglo', 'Kembangan Selatan', 'Kembangan Utara', 'Meruya Selatan', 'Meruya Utara', 'Srengseng'] }
                ]
            },
            {
                id: 'jaksel',
                name: 'Jakarta Selatan',
                color: '#10b981', // Green
                center: [-6.2600, 106.8100],
                boundary: [
                    [-6.205, 106.770], [-6.205, 106.860], [-6.300, 106.850], [-6.350, 106.800], [-6.250, 106.750]
                ],
                districts: [
                    { name: 'Kebayoran Baru', lat: -6.2380, lng: 106.8000, kels: ['Selong', 'Gunung', 'Kramat Pela', 'Gandaria Utara', 'Cipete Utara', 'Pulo', 'Melawai', 'Petogogan', 'Rawa Barat', 'Senayan'] },
                    { name: 'Kebayoran Lama', lat: -6.2450, lng: 106.7780, kels: ['Grogol Utara', 'Grogol Selatan', 'Cipulir', 'Kebayoran Lama Utara', 'Kebayoran Lama Selatan', 'Pondok Pinang'] },
                    { name: 'Pesanggrahan', lat: -6.2500, lng: 106.7600, kels: ['Ulujami', 'Petukangan Utara', 'Petukangan Selatan', 'Pesanggrahan', 'Bintaro'] },
                    { name: 'Cilandak', lat: -6.2900, lng: 106.8000, kels: ['Cipete Selatan', 'Gandaria Selatan', 'Cilandak Barat', 'Lebak Bulus', 'Pondok Labu'] },
                    { name: 'Pasar Minggu', lat: -6.2900, lng: 106.8400, kels: ['Pejaten Barat', 'Pejaten Timur', 'Pasar Minggu', 'Kebagusan', 'Jati Padang', 'Ragunan', 'Cilandak Timur'] },
                    { name: 'Jagakarsa', lat: -6.3300, lng: 106.8200, kels: ['Tanjung Barat', 'Lenteng Agung', 'Jagakarsa', 'Ciganjur', 'Srengseng Sawah', 'Cipedak'] },
                    { name: 'Mampang Prapatan', lat: -6.2500, lng: 106.8250, kels: ['Kuningan Barat', 'Pela Mampang', 'Bangka', 'Tegal Parang', 'Mampang Prapatan'] },
                    { name: 'Pancoran', lat: -6.2550, lng: 106.8500, kels: ['Kalibata', 'Rawa Jati', 'Duren Tiga', 'Cikoko', 'Pengadegan', 'Pancoran'] },
                    { name: 'Tebet', lat: -6.2300, lng: 106.8500, kels: ['Tebet Barat', 'Tebet Timur', 'Kebon Baru', 'Bukit Duri', 'Manggarai', 'Manggarai Selatan', 'Menteng Dalam'] },
                    { name: 'Setiabudi', lat: -6.2150, lng: 106.8280, kels: ['Setiabudi', 'Karet', 'Karet Semanggi', 'Karet Kuningan', 'Kuningan Timur', 'Menteng Atas', 'Pasar Manggis', 'Guntur'] }
                ]
            },
            {
                id: 'jaktim',
                name: 'Jakarta Timur',
                color: '#a855f7', // Purple
                center: [-6.2200, 106.9000],
                boundary: [
                    [-6.155, 106.880], [-6.155, 106.960], [-6.300, 106.920], [-6.370, 106.880], [-6.210, 106.850]
                ],
                districts: [
                    { name: 'Matraman', lat: -6.2000, lng: 106.8600, kels: ['Pisangan Baru', 'Utan Kayu Selatan', 'Utan Kayu Utara', 'Kayu Manis', 'Pal Meriam', 'Kebon Manggis'] },
                    { name: 'Pulo Gadung', lat: -6.1950, lng: 106.8900, kels: ['Kayu Putih', 'Jati', 'Rawamangun', 'Pisangan Timur', 'Cipinang', 'Jatinegara Kaum', 'Pulo Gadung'] },
                    { name: 'Jatinegara', lat: -6.2250, lng: 106.8750, kels: ['Bali Mester', 'Kampung Melayu', 'Bidaracina', 'Cipinang Cempedak', 'Rawa Bunga', 'Cipinang Besar Utara', 'Cipinang Besar Selatan', 'Cipinang Muara'] },
                    { name: 'Duren Sawit', lat: -6.2300, lng: 106.9200, kels: ['Pondok Bambu', 'Duren Sawit', 'Pondok Kelapa', 'Pondok Kopi', 'Malaka Jaya', 'Malaka Sari', 'Klender'] },
                    { name: 'Kramat Jati', lat: -6.2700, lng: 106.8700, kels: ['Kramat Jati', 'Batu Ampar', 'Balekambang', 'Kampung Tengah', 'Dukuh', 'Cawang', 'Cililitan'] },
                    { name: 'Makasar', lat: -6.2700, lng: 106.8950, kels: ['Pinang Ranti', 'Makasar', 'Halim Perdana Kusuma', 'Cipinang Melayu', 'Kebon Pala'] },
                    { name: 'Pasar Rebo', lat: -6.3150, lng: 106.8600, kels: ['Pekayon', 'Gedong', 'Cijantung', 'Baru', 'Kalisari'] },
                    { name: 'Ciracas', lat: -6.3300, lng: 106.8750, kels: ['Cibubur', 'Kelapa Dua Wetan', 'Ciracas', 'Susukan', 'Rambutan'] },
                    { name: 'Cipayung', lat: -6.3200, lng: 106.9100, kels: ['Lubang Buaya', 'Ceger', 'Cipayung', 'Munjul', 'Pondok Ranggon', 'Cilangkap', 'Setu', 'Bambu Apus'] },
                    { name: 'Cakung', lat: -6.1900, lng: 106.9400, kels: ['Cakung', 'Cakung Timur', 'Rawa Terate', 'Jatinegara', 'Penggilingan', 'Pulo Gebang', 'Ujung Menteng'] }
                ]
            }
        ];

        // --- 2. INITIALIZE MAP ---
        // Center view to see whole Jakarta
        const map = L.map('map', { 
            zoomControl: false 
        }).setView([-6.2088, 106.8456], 11);

        // Add Tile Layer (CartoDB Light for clean look)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: 'OpenStreetMap, CartoDB',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        L.control.zoom({ position: 'topright' }).addTo(map);

        // --- 3. LOGIC FOR LAYERS ---
        let layers = {
            polygons: L.layerGroup().addTo(map),
            markers: L.layerGroup().addTo(map)
        };

        const cityListContainer = document.getElementById('city-list');
        const detailPanel = document.getElementById('detail-panel');

        // Helper to create polygon style
        function getStyle(color) {
            return {
                color: color,
                weight: 2,
                opacity: 0.8,
                fillOpacity: 0.1,
                dashArray: '5, 5' // Dashed lines for "Region" look
            };
        }

        // --- 4. RENDER UI & MAP ELEMENTS ---
        jakartaData.forEach(city => {
            // A. Draw City Boundary (Polygon)
            const polygon = L.polygon(city.boundary, getStyle(city.color))
                .bindPopup(`<b>${city.name}</b><br>Total Kecamatan: ${city.districts.length}`)
                .addTo(layers.polygons);
            
            // Interaction on Polygon
            polygon.on('click', () => {
                map.flyTo(city.center, 12);
                expandSidebar(city.id);
            });

            // B. Render Sidebar Item
            const cityItem = document.createElement('div');
            cityItem.className = "mb-2 border border-gray-200 rounded-lg bg-white overflow-hidden";
            cityItem.innerHTML = `
                <button onclick="toggleAccordion('${city.id}')" class="w-full px-4 py-3 flex items-center justify-between bg-slate-50 hover:bg-slate-100 transition">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" style="background-color: ${city.color}"></div>
                        <span class="font-bold text-sm text-slate-700">${city.name}</span>
                    </div>
                    <i id="icon-${city.id}" class="fa-solid fa-chevron-down text-xs text-gray-400 transition-transform"></i>
                </button>
                <div id="acc-${city.id}" class="accordion-content bg-white">
                    <ul class="text-sm p-2 space-y-1">
                        ${city.districts.map(dist => `
                            <li>
                                <button onclick="focusDistrict('${city.id}', '${dist.name}')" class="w-full text-left px-3 py-2 rounded hover:bg-slate-50 text-slate-600 hover:text-blue-600 flex justify-between group">
                                    <span>${dist.name}</span>
                                    <span class="text-[10px] text-gray-300 group-hover:text-blue-400 bg-gray-50 px-1 rounded">${dist.kels.length} Kel</span>
                                </button>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;
            cityListContainer.appendChild(cityItem);

            // C. Create Markers for Districts (Initially Hidden/Clustered logic - but we show all for comprehensive view)
            city.districts.forEach(dist => {
                const markerHtml = `<div class="pulse-dot" style="background-color: ${city.color}"></div>`;
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: markerHtml,
                    iconSize: [16, 16],
                    iconAnchor: [8, 8]
                });

                const marker = L.marker([dist.lat, dist.lng], { icon: icon })
                    .bindTooltip(dist.name, { 
                        permanent: true, // MAKE PERMANENT as requested
                        direction: 'bottom', 
                        offset: [0, 8],
                        className: 'kecamatan-label' // Use Custom CSS class defined above
                    });
                
                // Click Marker -> Show Details
                marker.on('click', () => {
                    showDistrictDetail(city, dist);
                    map.flyTo([dist.lat, dist.lng], 14);
                });

                // Store reference for lookup
                dist.marker = marker; 
                layers.markers.addLayer(marker);
            });
        });

        // --- 5. INTERACTION FUNCTIONS ---

        function toggleAccordion(cityId) {
            // Close others
            jakartaData.forEach(c => {
                if (c.id !== cityId) {
                    document.getElementById(`acc-${c.id}`).classList.remove('active');
                    document.getElementById(`icon-${c.id}`).classList.remove('rotate-180');
                }
            });

            // Toggle current
            const content = document.getElementById(`acc-${cityId}`);
            const icon = document.getElementById(`icon-${cityId}`);
            content.classList.toggle('active');
            icon.classList.toggle('rotate-180');
        }

        function expandSidebar(cityId) {
             const content = document.getElementById(`acc-${cityId}`);
             if (!content.classList.contains('active')) {
                 toggleAccordion(cityId);
             }
        }

        function focusDistrict(cityId, districtName) {
            const city = jakartaData.find(c => c.id === cityId);
            const dist = city.districts.find(d => d.name === districtName);
            
            if (dist) {
                map.flyTo([dist.lat, dist.lng], 14);
                showDistrictDetail(city, dist);
            }
        }

        function showDistrictDetail(city, district) {
            detailPanel.classList.remove('hidden');
            document.getElementById('detail-parent').innerText = city.name;
            document.getElementById('detail-parent').style.color = city.color;
            document.getElementById('detail-title').innerText = "Kec. " + district.name;
            
            const tagsContainer = document.getElementById('detail-tags');
            tagsContainer.innerHTML = district.kels.map(k => 
                `<span class="bg-gray-100 text-gray-600 text-[11px] px-2 py-1 rounded border border-gray-200 font-medium">${k}</span>`
            ).join('');

            // Ensure sidebar is open on mobile to see the details
            const sb = document.getElementById('sidebar');
            if (sb.classList.contains('-translate-x-full')) {
                sb.classList.remove('-translate-x-full');
            }
        }

        function closeDetail() {
            detailPanel.classList.add('hidden');
        }

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            sb.classList.toggle('-translate-x-full');
        }

        // Initial Responsive State
        if (window.innerWidth < 768) {
            document.getElementById('sidebar').classList.add('-translate-x-full');
        }

    </script>
</body>
</html>
